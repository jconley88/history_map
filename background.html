<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
<script>
    var h = [];
    chrome.history.onVisited.addListener(function(result) {
        h.push(result.url)
    });
    function getHistory(){
        return h
    }
    var r = [];
    chrome.extension.onRequest.addListener(function(elem, sender, sendResponse){
        r.push(elem);
        sendResponse(r);
    });
    function getReferrer(){
        var next_to_last_element = r.length - 2
        return r[next_to_last_element];
    }
    function getCurrent(){
        return r[r.length - 1]
    }

    chrome.browserAction.onClicked.addListener(function( tab){
        chrome.tabs.sendRequest(tab.id,{referrer : getReferrer(), current : getCurrent()})
//        chrome.tabs.update(tab.id,{url: r})
    });
</script>